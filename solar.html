<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Accurate 3D Solar System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: radial-gradient(
          ellipse at bottom,
          #0c1445 0%,
          #02021a 100%
        );
        color: #fff;
        overflow: hidden;
        height: 100vh;
      }

      #container {
        position: relative;
        width: 100vw;
        height: 100vh;
      }

      #controls {
        position: absolute;
        top: 20px;
        left: 20px;
        z-index: 1000;
        background: rgba(10, 15, 30, 0.85);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 0 25px rgba(100, 150, 255, 0.4);
        border: 1px solid rgba(100, 180, 255, 0.5);
        max-width: 300px;
        backdrop-filter: blur(10px);
        transform: translateY(0);
        transition: transform 0.3s ease;
      }

      #controls:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 30px rgba(100, 150, 255, 0.6);
      }

      .control-group {
        margin-bottom: 15px;
      }

      .control-group label {
        display: block;
        margin-bottom: 8px;
        color: #aad4ff;
        font-weight: 600;
        font-size: 14px;
      }

      .slider-container {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .slider {
        flex: 1;
        -webkit-appearance: none;
        height: 8px;
        border-radius: 4px;
        background: linear-gradient(to right, #1a5f9e, #4aa9e2);
        outline: none;
      }

      .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #fff;
        cursor: pointer;
        box-shadow: 0 0 10px rgba(100, 180, 255, 0.8);
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .slider::-webkit-slider-thumb:hover {
        transform: scale(1.2);
        box-shadow: 0 0 15px rgba(100, 180, 255, 1);
      }

      .button {
        background: linear-gradient(to bottom, #2c3e50, #1a2a3a);
        border: 1px solid #4aa9e2;
        border-radius: 8px;
        padding: 10px 20px;
        color: #fff;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin: 5px 0;
        width: 100%;
        font-size: 14px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      .button:hover {
        background: linear-gradient(to bottom, #34495e, #2c3e50);
        border-color: #5dade2;
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
      }

      .value-display {
        min-width: 60px;
        text-align: center;
        font-size: 12px;
        color: #fff;
        background: rgba(74, 169, 226, 0.2);
        padding: 4px 8px;
        border-radius: 6px;
        border: 1px solid rgba(100, 180, 255, 0.3);
      }

      #info {
        position: absolute;
        bottom: 20px;
        left: 20px;
        z-index: 1000;
        background: rgba(10, 15, 30, 0.85);
        border-radius: 15px;
        padding: 15px;
        box-shadow: 0 0 15px rgba(100, 150, 255, 0.4);
        border: 1px solid rgba(100, 180, 255, 0.5);
        max-width: 300px;
        font-size: 13px;
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
      }

      #info:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 25px rgba(100, 150, 255, 0.5);
      }

      #info h3 {
        color: #aad4ff;
        margin-bottom: 10px;
        border-bottom: 1px solid rgba(100, 180, 255, 0.4);
        padding-bottom: 5px;
        font-size: 1.1rem;
      }
      .moon-label {
        position: absolute;
        background: rgba(10, 15, 30, 0.7);
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 9px;
        color: #aaffaa;
        pointer-events: none;
        transform: translate(-50%, -100%);
        white-space: nowrap;
        box-shadow: 0 1px 5px rgba(0, 0, 0, 0.5);
        border: 1px solid rgba(100, 255, 100, 0.4);
        text-shadow: 0 0 3px rgba(0, 255, 0, 0.7);
        opacity: 0.8;
        transition: opacity 0.3s;
      }
      .tooltip {
        position: absolute;
        background: rgba(10, 15, 30, 0.95);
        border-radius: 12px;
        padding: 12px 15px;
        pointer-events: none;
        z-index: 2000;
        box-shadow: 0 0 20px rgba(100, 150, 255, 0.5);
        border: 1px solid rgba(100, 180, 255, 0.6);
        font-size: 13px;
        max-width: 300px;
        backdrop-filter: blur(10px);
        display: none;
        transform: scale(0.95);
        opacity: 0;
        transition: transform 0.3s, opacity 0.3s;
      }

      .tooltip.show {
        display: block;
        transform: scale(1);
        opacity: 1;
      }

      .tooltip h3 {
        color: #5dade2;
        margin-bottom: 8px;
        font-size: 16px;
      }

      .tooltip p {
        margin-bottom: 5px;
        color: #bbdfff;
      }

      .checkbox-group {
        display: flex;
        align-items: center;
        gap: 8px;
        margin: 5px 0;
      }

      .checkbox-group input[type="checkbox"] {
        width: 16px;
        height: 16px;
        accent-color: #4aa9e2;
        cursor: pointer;
      }

      .checkbox-group label {
        margin: 0;
        font-size: 13px;
        cursor: pointer;
        color: #bbdfff;
        transition: color 0.3s;
      }

      .checkbox-group:hover label {
        color: #fff;
      }

      .planet-label {
        position: absolute;
        background: rgba(10, 15, 30, 0.9);
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 11px;
        color: #fff;
        pointer-events: none;
        transform: translate(-50%, -100%);
        white-space: nowrap;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        border: 1px solid rgba(100, 180, 255, 0.4);
        text-shadow: 0 0 5px rgba(255, 255, 255, 0.7);
        opacity: 0.9;
        transition: opacity 0.3s;
      }

      #loading {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 2000;
        flex-direction: column;
        transition: opacity 1s ease;
      }

      .loader {
        width: 80px;
        height: 80px;
        border: 5px solid rgba(74, 169, 226, 0.3);
        border-radius: 50%;
        border-top-color: #4aa9e2;
        animation: spin 1.5s linear infinite;
        margin-bottom: 20px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      #loading-text {
        font-size: 1.4rem;
        color: #aad4ff;
        animation: pulse 2s infinite;
        text-align: center;
        max-width: 300px;
      }

      @keyframes pulse {
        0% {
          opacity: 0.6;
        }
        50% {
          opacity: 1;
        }
        100% {
          opacity: 0.6;
        }
      }

      .stats {
        position: absolute;
        bottom: 20px;
        right: 20px;
        background: rgba(10, 15, 30, 0.85);
        border-radius: 15px;
        padding: 10px 15px;
        font-size: 12px;
        z-index: 1000;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(100, 180, 255, 0.4);
        box-shadow: 0 0 15px rgba(100, 150, 255, 0.3);
      }

      .planet-selector {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 10px;
      }

      .planet-btn {
        background: rgba(74, 169, 226, 0.2);
        border: 1px solid rgba(100, 180, 255, 0.3);
        border-radius: 20px;
        padding: 6px 12px;
        color: #fff;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .planet-btn:hover {
        background: rgba(74, 169, 226, 0.4);
        transform: translateY(-2px);
        box-shadow: 0 0 10px rgba(100, 180, 255, 0.3);
      }

      .planet-btn.active {
        background: rgba(74, 169, 226, 0.6);
        border-color: #5dade2;
        box-shadow: 0 0 15px rgba(100, 180, 255, 0.5);
      }

      .moon-counter {
        position: absolute;
        top: 150px;
        right: 20px;
        z-index: 1000;
        background: rgba(10, 15, 30, 0.85);
        border-radius: 15px;
        padding: 15px;
        box-shadow: 0 0 15px rgba(100, 150, 255, 0.4);
        border: 1px solid rgba(100, 180, 255, 0.5);
        max-width: 300px;
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
      }

      .moon-counter h3 {
        color: #aad4ff;
        margin-bottom: 10px;
        border-bottom: 1px solid rgba(100, 180, 255, 0.4);
        padding-bottom: 5px;
        font-size: 1.1rem;
      }

      /* Mobile responsiveness */
      @media (max-width: 768px) {
        #controls {
          top: 10px;
          left: 10px;
          right: 10px;
          max-width: none;
          width: calc(100% - 20px);
        }

        #info {
          left: 10px;
          right: 10px;
          width: calc(100% - 20px);
          max-width: none;
        }

        .stats {
          left: 10px;
          right: auto;
          bottom: 80px;
        }

        .planet-selector {
          justify-content: center;
        }

        .moon-counter {
          top: auto;
          bottom: 150px;
          left: 10px;
          right: 10px;
          width: calc(100% - 20px);
        }
      }
    </style>
  </head>
  <body>
    <div id="loading">
      <div class="loader"></div>
      <div id="loading-text">
        Loading Planetary Textures<br />Please wait...
      </div>
    </div>

    <div id="container">
      <div id="controls">
        <div class="control-group">
          <label>Orbital Speed: <span id="timeScaleVal">8x</span></label>
          <div class="slider-container">
            <input
              type="range"
              id="timeScale"
              class="slider"
              min="0.1"
              max="20"
              step="0.1"
              value="8"
            />
          </div>
        </div>

        <div class="checkbox-group">
          <input type="checkbox" id="showOrbits" checked />
          <label for="showOrbits">Show Orbits</label>
        </div>
        <div class="checkbox-group">
          <input type="checkbox" id="showLabels" checked />
          <label for="showLabels">Show Labels</label>
        </div>
        <div class="checkbox-group">
          <input type="checkbox" id="showMoons" checked />
          <label for="showMoons">Show Moons</label>
        </div>
        <div class="checkbox-group">
          <input type="checkbox" id="showMoonOrbits" checked />
          <label for="showMoonOrbits">Show Moon Orbits</label>
        </div>

        <button id="pauseBtn" class="button">Pause</button>
        <button id="resetBtn" class="button">Reset View</button>
        <button id="autoRotateBtn" class="button">Auto-Rotate: ON</button>

        <div class="control-group">
          <label>Focus on Planet:</label>
          <div class="planet-selector">
            <div class="planet-btn active" data-planet="Sun">Sun</div>
            <div class="planet-btn" data-planet="Mercury">Mercury</div>
            <div class="planet-btn" data-planet="Venus">Venus</div>
            <div class="planet-btn" data-planet="Earth">Earth</div>
            <div class="planet-btn" data-planet="Mars">Mars</div>
            <div class="planet-btn" data-planet="Jupiter">Jupiter</div>
            <div class="planet-btn" data-planet="Saturn">Saturn</div>
            <div class="planet-btn" data-planet="Uranus">Uranus</div>
            <div class="planet-btn" data-planet="Neptune">Neptune</div>
            <div class="planet-btn" data-planet="Pluto">Pluto</div>
          </div>
        </div>
      </div>

      <div id="info">
        <h3>Solar System Information</h3>
        <p><strong>Planets:</strong> 8 + Pluto</p>
        <p>
          <strong>Time:</strong> <span id="currentTime">0</span> Earth years
          elapsed
        </p>
        <p><strong>Controls:</strong> Mouse to orbit, scroll to zoom</p>
        <p><strong>Moons:</strong> All major moons included</p>
        <p><strong>Scale:</strong> Enhanced for visibility</p>
        <p><strong>Orbits:</strong> Realistic inclinations</p>
      </div>

      <div class="moon-counter">
        <h3>Moons by Planet</h3>
        <p><strong>Earth:</strong> 1 moon</p>
        <p><strong>Mars:</strong> 2 moons</p>
        <p><strong>Jupiter:</strong> 4 large moons</p>
        <p><strong>Saturn:</strong> 7 major moons</p>
        <p><strong>Uranus:</strong> 5 major moons</p>
        <p><strong>Neptune:</strong> 2 moons</p>
        <p><strong>Pluto:</strong> 1 moon</p>
      </div>

      <div class="stats">
        FPS: <span id="fps">0</span> | Planets: 9 | Moons: 21 | Scale: Enhanced
      </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script>
      // Planetary data with all moons and accurate orbital inclinations
      const PLANETS = {
        Sun: {
          type: "star",
          radius: 696340,
          texture:
            "https://images-assets.nasa.gov/image/PIA14093/PIA14093~orig.jpg",
          position: { x: 0, y: 0, z: 0 },
          lightIntensity: 4.0, // Increased brightness
          description:
            "The Sun is the star at the center of our Solar System. It's a nearly perfect sphere of hot plasma, heated to incandescence by nuclear fusion reactions in its core.",
          orbitalInclination: 0,
        },
        Mercury: {
          type: "planet",
          radius: 2439.7,
          texture:
            "https://images-assets.nasa.gov/image/PIA15190/PIA15190~orig.jpg",
          distance: 57.9,
          orbitalPeriod: 0.24,
          rotationPeriod: 58.6,
          tilt: 0.03,
          orbitalInclination: 7.0,
          description:
            "Mercury is the smallest and innermost planet in the Solar System. It has no natural satellites and its surface is heavily cratered.",
        },
        Venus: {
          type: "planet",
          radius: 6051.8,
          texture:
            "https://images-assets.nasa.gov/image/PIA00271/PIA00271~orig.jpg",
          distance: 108.2,
          orbitalPeriod: 0.62,
          rotationPeriod: 243,
          tilt: 177.3,
          orbitalInclination: 3.4,
          description:
            "Venus is the second planet from the Sun. It's the hottest planet in our Solar System due to its thick atmosphere and runaway greenhouse effect.",
        },
        Earth: {
          type: "planet",
          radius: 6371,
          texture:
            "https://images-assets.nasa.gov/image/GSFC_20171208_Archive_e001589/GSFC_20171208_Archive_e001589~orig.jpg",
          distance: 149.6,
          orbitalPeriod: 1,
          rotationPeriod: 1,
          tilt: 23.44,
          orbitalInclination: 0.0,
          moons: [
            {
              name: "Moon",
              radius: 1737.4,
              distance: 30,
              orbitalPeriod: 27.3,
              texture:
                "https://images-assets.nasa.gov/image/AS16-118-18884/AS16-118-18884~thumb.jpg",
              orbitalInclination: 5.14,
            },
          ],
          description:
            "Earth is the third planet from the Sun and the only astronomical object known to harbor life. About 71% of its surface is covered with water.",
        },
        Mars: {
          type: "planet",
          radius: 3389.5,
          texture:
            "https://images-assets.nasa.gov/image/PIA00407/PIA00407~orig.jpg",
          distance: 227.9,
          orbitalPeriod: 1.88,
          rotationPeriod: 1.03,
          tilt: 25.19,
          orbitalInclination: 1.85,
          moons: [
            {
              name: "Phobos",
              radius: 11.1,
              distance: 15,
              orbitalPeriod: 0.3,
              texture:
                "https://images-assets.nasa.gov/image/PIA10368/PIA10368~orig.jpg",
              orbitalInclination: 1.08,
            },
            {
              name: "Deimos",
              radius: 6.2,
              distance: 25,
              orbitalPeriod: 1.3,
              texture:
                "https://images-assets.nasa.gov/image/PIA11826/PIA11826~orig.jpg",
              orbitalInclination: 0.93,
            },
          ],
          description:
            "Mars is the fourth planet from the Sun. It's often called the 'Red Planet' due to iron oxide prevalent on its surface.",
        },
        Jupiter: {
          type: "planet",
          radius: 69911,
          texture:
            "https://images-assets.nasa.gov/image/PIA22946/PIA22946~orig.jpg",
          distance: 778.5,
          orbitalPeriod: 11.86,
          rotationPeriod: 0.41,
          tilt: 3.13,
          orbitalInclination: 1.31,
          moons: [
            {
              name: "Io",
              radius: 1821.6,
              distance: 50,
              orbitalPeriod: 1.8,
              texture:
                "https://images-assets.nasa.gov/image/PIA02308/PIA02308~orig.jpg",
              orbitalInclination: 0.04,
            },
            {
              name: "Europa",
              radius: 1560.8,
              distance: 70,
              orbitalPeriod: 3.6,
              texture:
                "https://images-assets.nasa.gov/image/PIA01130/PIA01130~orig.jpg",
              orbitalInclination: 0.47,
            },
            {
              name: "Ganymede",
              radius: 2634.1,
              distance: 90,
              orbitalPeriod: 7.2,
              texture:
                "https://images-assets.nasa.gov/image/PIA01096/PIA01096~orig.jpg",
              orbitalInclination: 0.18,
            },
            {
              name: "Callisto",
              radius: 2408.4,
              distance: 110,
              orbitalPeriod: 16.7,
              texture:
                "https://images-assets.nasa.gov/image/PIA03456/PIA03456~orig.jpg",
              orbitalInclination: 0.19,
            },
          ],
          description:
            "Jupiter is the fifth planet from the Sun and the largest in the Solar System. It's a gas giant with a mass more than two and a half times that of all the other planets combined.",
        },
        Saturn: {
          type: "planet",
          radius: 58232,
          texture:
            "https://images-assets.nasa.gov/image/PIA01977/PIA01977~orig.jpg",
          distance: 1432,
          orbitalPeriod: 29.46,
          rotationPeriod: 0.44,
          tilt: 26.73,
          orbitalInclination: 2.49,
          hasRings: true,
          moons: [
            {
              name: "Titan",
              radius: 2574.7,
              distance: 60,
              orbitalPeriod: 15.9,
              texture:
                "https://images-assets.nasa.gov/image/PIA20016/PIA20016~orig.jpg",
              orbitalInclination: 0.33,
            },
            {
              name: "Rhea",
              radius: 764.3,
              distance: 80,
              orbitalPeriod: 4.5,
              texture:
                "https://images-assets.nasa.gov/image/PIA07764/PIA07764~orig.jpg",
              orbitalInclination: 0.35,
            },
            {
              name: "Enceladus",
              radius: 252.1,
              distance: 100,
              orbitalPeriod: 1.4,
              texture:
                "https://images-assets.nasa.gov/image/PIA17202/PIA17202~orig.jpg",
              orbitalInclination: 0.0,
            },
            {
              name: "Dione",
              radius: 561.4,
              distance: 120,
              orbitalPeriod: 2.7,
              texture:
                "https://images-assets.nasa.gov/image/PIA07638/PIA07638~orig.jpg",
              orbitalInclination: 0.02,
            },
            {
              name: "Tethys",
              radius: 533,
              distance: 140,
              orbitalPeriod: 1.9,
              texture:
                "https://images-assets.nasa.gov/image/PIA08400/PIA08400~orig.jpg",
              orbitalInclination: 1.12,
            },
            {
              name: "Iapetus",
              radius: 734.5,
              distance: 160,
              orbitalPeriod: 79.3,
              texture:
                "https://images-assets.nasa.gov/image/PIA08384/PIA08384~orig.jpg",
              orbitalInclination: 15.47,
            },
            {
              name: "Mimas",
              radius: 198.2,
              distance: 180,
              orbitalPeriod: 0.9,
              texture:
                "https://images-assets.nasa.gov/image/PIA12572/PIA12572~orig.jpg",
              orbitalInclination: 1.57,
            },
          ],
          description:
            "Saturn is the sixth planet from the Sun and the second-largest in the Solar System. It's known for its prominent ring system that consists mainly of ice particles.",
        },
        Uranus: {
          type: "planet",
          radius: 25362,
          texture:
            "https://images-assets.nasa.gov/image/PIA18182/PIA18182~orig.jpg",
          distance: 2867,
          orbitalPeriod: 84.01,
          rotationPeriod: 0.72,
          tilt: 97.77,
          orbitalInclination: 0.77,
          moons: [
            {
              name: "Titania",
              radius: 788.9,
              distance: 40,
              orbitalPeriod: 8.7,
              texture:
                "https://images-assets.nasa.gov/image/PIA00039/PIA00039~orig.jpg",
              orbitalInclination: 0.14,
            },
            {
              name: "Oberon",
              radius: 761.4,
              distance: 60,
              orbitalPeriod: 13.5,
              texture:
                "https://images-assets.nasa.gov/image/PIA00040/PIA00040~orig.jpg",
              orbitalInclination: 0.1,
            },
            {
              name: "Umbriel",
              radius: 584.7,
              distance: 80,
              orbitalPeriod: 4.1,
              texture:
                "https://images-assets.nasa.gov/image/PIA00041/PIA00041~orig.jpg",
              orbitalInclination: 0.13,
            },
            {
              name: "Ariel",
              radius: 578.9,
              distance: 100,
              orbitalPeriod: 2.5,
              texture:
                "https://images-assets.nasa.gov/image/PIA00042/PIA00042~orig.jpg",
              orbitalInclination: 0.31,
            },
            {
              name: "Miranda",
              radius: 235.8,
              distance: 120,
              orbitalPeriod: 1.4,
              texture:
                "https://images-assets.nasa.gov/image/PIA00044/PIA00044~orig.jpg",
              orbitalInclination: 4.23,
            },
          ],
          description:
            "Uranus is the seventh planet from the Sun. It has the third-largest planetary radius and fourth-largest planetary mass in the Solar System.",
        },
        Neptune: {
          type: "planet",
          radius: 24622,
          texture:
            "https://images-assets.nasa.gov/image/PIA01492/PIA01492~orig.jpg",
          distance: 4515,
          orbitalPeriod: 164.8,
          rotationPeriod: 0.67,
          tilt: 28.32,
          orbitalInclination: 1.77,
          moons: [
            {
              name: "Triton",
              radius: 1353.4,
              distance: 45,
              orbitalPeriod: -5.9,
              texture:
                "https://images-assets.nasa.gov/image/PIA01537/PIA01537~orig.jpg",
              orbitalInclination: 156.83,
            },
            {
              name: "Proteus",
              radius: 210,
              distance: 65,
              orbitalPeriod: 1.1,
              texture:
                "https://images-assets.nasa.gov/image/PIA00059/PIA00059~orig.jpg",
              orbitalInclination: 0.52,
            },
          ],
          description:
            "Neptune is the eighth and farthest known planet from the Sun. It's the fourth-largest planet by diameter and the third-largest by mass.",
        },
        Pluto: {
          type: "dwarf",
          radius: 1188.3,
          texture:
            "https://images-assets.nasa.gov/image/PIA19952/PIA19952~orig.jpg",
          distance: 5906.4,
          orbitalPeriod: 248.09,
          rotationPeriod: 6.387,
          tilt: 122.5,
          orbitalInclination: 17.16,
          moons: [
            {
              name: "Charon",
              radius: 606,
              distance: 25,
              orbitalPeriod: 6.4,
              texture:
                "https://images-assets.nasa.gov/image/PIA19873/PIA19873~orig.jpg",
              orbitalInclination: 0.0,
            },
          ],
          description:
            "Pluto is a dwarf planet in the Kuiper belt. It was considered the ninth planet until 2006 when the IAU reclassified it as a dwarf planet.",
        },
      };

      class SolarSystem {
        constructor() {
          this.scene = null;
          this.camera = null;
          this.renderer = null;
          this.controls = null;
          this.planets = {};
          this.moons = {};
          this.orbitLines = {};
          this.moonOrbitLines = {};
          this.labels = {};
          this.lastTime = 0;
          this.fps = 0;
          this.fpsCounter = 0;
          this.fpsTime = 0;
          this.textureLoader = new THREE.TextureLoader();
          this.moonLabels = {}; // Store moon labels

          // Settings
          this.timeScale = 8;
          this.showOrbits = true;
          this.showMoonOrbits = true;
          this.showLabels = true;
          this.showMoons = true;
          this.paused = false;
          this.autoRotate = true;

          // Time tracking
          this.clock = new THREE.Clock();
          this.elapsedTime = 0;

          // Interaction
          this.raycaster = new THREE.Raycaster();
          this.mouse = new THREE.Vector2();
          this.tooltip = document.getElementById("tooltip");
          this.hoveredPlanet = null;

          this.init();
        }

        init() {
          this.setupScene();
          this.setupLighting();
          this.createPlanets();
          this.setupControls();
          this.animate();
        }

        setupScene() {
          this.scene = new THREE.Scene();
          this.scene.background = new THREE.Color(0x000011);

          this.camera = new THREE.PerspectiveCamera(
            60,
            window.innerWidth / window.innerHeight,
            0.1,
            100000
          );
          this.camera.position.set(0, 300, 500);

          this.renderer = new THREE.WebGLRenderer({
            antialias: true,
            alpha: true,
          });
          this.renderer.setSize(window.innerWidth, window.innerHeight);
          this.renderer.shadowMap.enabled = true;
          this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;
          this.renderer.setPixelRatio(window.devicePixelRatio);
          document
            .getElementById("container")
            .appendChild(this.renderer.domElement);

          window.addEventListener("resize", () => this.onWindowResize());
        }

        setupLighting() {
          // Ambient light for overall scene
          const ambientLight = new THREE.AmbientLight(0xffffff, 0.3);
          this.scene.add(ambientLight);

          // Sun as the main light source - increased brightness
          this.sunLight = new THREE.PointLight(
            0xffffff,
            PLANETS.Sun.lightIntensity * 2.5, // Increased intensity
            0,
            2
          );
          this.sunLight.position.set(0, 0, 0);
          this.sunLight.castShadow = true;
          this.sunLight.shadow.mapSize.width = 2048;
          this.sunLight.shadow.mapSize.height = 2048;
          this.sunLight.shadow.bias = -0.001;
          this.scene.add(this.sunLight);

          // Additional directional light to enhance brightness
          const directionalLight = new THREE.DirectionalLight(0xffffee, 1.0);
          directionalLight.position.set(5, 3, 5);
          directionalLight.castShadow = true;
          this.scene.add(directionalLight);
        }

        createPlanets() {
          const planetPromises = Object.entries(PLANETS).map(([name, data]) => {
            return new Promise((resolve) => {
              this.textureLoader.load(
                data.texture,
                (texture) => {
                  this.createPlanet(name, data, texture);
                  if (data.type === "planet" || data.type === "dwarf") {
                    this.createOrbit(name, data);
                  }

                  // Create moons if they exist
                  if (data.moons) {
                    this.moons[name] = {};
                    data.moons.forEach((moonData) => {
                      this.textureLoader.load(
                        moonData.texture,
                        (moonTexture) => {
                          this.createMoon(name, moonData, moonTexture);
                          this.createMoonOrbit(name, moonData);
                        },
                        undefined,
                        () => {
                          // Fallback if texture fails
                          this.createMoon(name, moonData, null);
                          this.createMoonOrbit(name, moonData);
                        }
                      );
                    });
                  }

                  resolve();
                },
                undefined,
                (error) => {
                  console.error(`Error loading texture for ${name}:`, error);
                  // Create planet with fallback color
                  this.createPlanet(name, data, null);
                  resolve();
                }
              );
            });
          });

          // Hide loading screen when all textures are loaded
          Promise.all(planetPromises).then(() => {
            document.getElementById("loading").style.opacity = "0";
            setTimeout(() => {
              document.getElementById("loading").style.display = "none";
            }, 1000);
          });
        }

        createPlanet(name, data, texture) {
          // Enhanced scaling for better visibility
          let radius;
          if (data.type === "star") {
            radius = 35; // Increased sun size
          } else {
            // Scale planets based on actual size with increased multiplier
            radius = Math.max(2, Math.pow(data.radius, 0.4) * 0.2); // Increased from 0.1 to 0.2

            // Make Pluto larger but still small
            if (name === "Pluto") radius *= 2.0;
          }

          const geometry = new THREE.SphereGeometry(radius, 64, 64);

          // Create material with texture
          let material;
          if (data.type === "star") {
            // Make sun brighter with emissive material
            material = new THREE.MeshBasicMaterial({
              map: texture,
              emissive: 0xffff99,
              emissiveIntensity: 1.5,
            });
          } else if (texture) {
            material = new THREE.MeshPhongMaterial({
              map: texture,
              shininess: 30,
              specular: 0x222222,
            });
          } else {
            // Fallback material if texture fails to load
            material = new THREE.MeshPhongMaterial({
              color: name === "Sun" ? 0xffff00 : 0x8888ff,
              shininess: 30,
              specular: 0x222222,
            });
          }

          const mesh = new THREE.Mesh(geometry, material);
          mesh.castShadow = data.type !== "star";
          mesh.receiveShadow = data.type !== "star";
          mesh.userData = {
            name,
            data,
            originalRadius: radius,
            orbitalRadius: data.distance ? data.distance * 1.5 : 0,
            description: data.description,
          };

          // Position planets
          if (data.type === "star") {
            mesh.position.set(0, 0, 0);
          } else {
            // Scale distances to fit nicely in view
            const distance = data.distance * 1.5;

            // Apply orbital inclination
            const angle = 0; // Start at 0 angle
            const inclination = data.orbitalInclination || 0;
            const inclinationRad = THREE.MathUtils.degToRad(inclination);

            // Calculate position with inclination
            const x = distance * Math.cos(angle);
            const z = distance * Math.sin(angle) * Math.cos(inclinationRad);
            const y = distance * Math.sin(angle) * Math.sin(inclinationRad);

            mesh.position.set(x, y, z);
            mesh.userData.orbitalRadius = distance;
            mesh.userData.orbitalInclination = inclination;

            // Apply planetary tilt
            mesh.rotation.z = THREE.MathUtils.degToRad(data.tilt || 0);
          }

          this.planets[name] = mesh;
          this.scene.add(mesh);

          // Add Saturn's rings
          if (data.hasRings) {
            this.createRings(mesh);
          }

          // Create label
          this.createLabel(name, mesh);
        }

        createMoon(planetName, moonData, texture) {
          const planet = this.planets[planetName];
          if (!planet) return;

          // Get planet's visual radius
          const planetRadius = planet.userData.originalRadius;

          // Calculate moon size relative to planet
          // Ensure moon is smaller than planet
          const maxMoonSize = planetRadius * 0.5; // Moons can't be larger than half planet size
          let radius =
            (moonData.radius / planet.userData.data.radius) * planetRadius;

          // Apply visibility multiplier but ensure it doesn't exceed max size
          radius = Math.min(radius * 8, maxMoonSize); // Increased visibility but capped

          // Set minimum size for visibility
          radius = Math.max(radius, 1.0);

          const geometry = new THREE.SphereGeometry(radius, 32, 32);
          const material = texture
            ? new THREE.MeshPhongMaterial({
                map: texture,
                shininess: 20,
                specular: 0x111111,
              })
            : new THREE.MeshPhongMaterial({
                color: 0xaaaaaa,
                shininess: 20,
                specular: 0x111111,
              });

          const mesh = new THREE.Mesh(geometry, material);
          mesh.castShadow = true;
          mesh.receiveShadow = true;
          mesh.userData = {
            name: moonData.name,
            planet: planetName,
            data: moonData,
            originalRadius: radius,
            orbitalRadius: moonData.distance,
            orbitalInclination: moonData.orbitalInclination || 0,
          };

          // Position moon relative to planet with increased distance for visibility
          const moonDistance = moonData.distance * 1.5;
          const angle = 0;
          const inclination = moonData.orbitalInclination || 0;
          const inclinationRad = THREE.MathUtils.degToRad(inclination);

          const x = moonDistance * Math.cos(angle);
          const z = moonDistance * Math.sin(angle) * Math.cos(inclinationRad);
          const y = moonDistance * Math.sin(angle) * Math.sin(inclinationRad);

          mesh.position.set(x, y, z);
          planet.add(mesh);

          // Store moon reference
          if (!this.moons[planetName]) this.moons[planetName] = {};
          this.moons[planetName][moonData.name] = mesh;

          // Create moon label
          this.createMoonLabel(planetName, moonData.name, mesh);
        }

        createMoonLabel(planetName, moonName, moonMesh) {
          const labelDiv = document.createElement("div");
          labelDiv.className = "moon-label";
          labelDiv.textContent = moonName;
          labelDiv.style.display = this.showLabels ? "block" : "none";
          document.body.appendChild(labelDiv);

          if (!this.moonLabels[planetName]) this.moonLabels[planetName] = {};
          this.moonLabels[planetName][moonName] = labelDiv;
        }

        createRings(planet) {
          const ringGeometry = new THREE.RingGeometry(
            planet.userData.originalRadius * 1.5,
            planet.userData.originalRadius * 2.5,
            64
          );
          const ringMaterial = new THREE.MeshPhongMaterial({
            color: 0xddddbb,
            side: THREE.DoubleSide,
            transparent: true,
            opacity: 0.8,
            shininess: 50,
            specular: 0x333333,
          });
          const rings = new THREE.Mesh(ringGeometry, ringMaterial);
          rings.rotation.x = Math.PI / 2;
          planet.add(rings);
        }

        createOrbit(name, data) {
          const distance = data.distance * 1.5;
          const inclination = data.orbitalInclination || 0;
          const inclinationRad = THREE.MathUtils.degToRad(inclination);
          const segments = 100;
          const points = [];

          for (let i = 0; i <= segments; i++) {
            const theta = (i / segments) * Math.PI * 2;
            const x = distance * Math.cos(theta);
            const z = distance * Math.sin(theta) * Math.cos(inclinationRad);
            const y = distance * Math.sin(theta) * Math.sin(inclinationRad);
            points.push(new THREE.Vector3(x, y, z));
          }

          const geometry = new THREE.BufferGeometry().setFromPoints(points);
          const material = new THREE.LineBasicMaterial({
            color: 0x4488ff,
            transparent: true,
            opacity: 0.3,
            linewidth: 1,
          });

          const orbitLine = new THREE.Line(geometry, material);
          orbitLine.visible = this.showOrbits;
          this.orbitLines[name] = orbitLine;
          this.scene.add(orbitLine);
        }

        createMoonOrbit(planetName, moonData) {
          const planet = this.planets[planetName];
          if (!planet) return;

          const distance = moonData.distance * 1.5;
          const inclination = moonData.orbitalInclination || 0;
          const inclinationRad = THREE.MathUtils.degToRad(inclination);
          const segments = 100;
          const points = [];

          for (let i = 0; i <= segments; i++) {
            const theta = (i / segments) * Math.PI * 2;
            const x = distance * Math.cos(theta);
            const z = distance * Math.sin(theta) * Math.cos(inclinationRad);
            const y = distance * Math.sin(theta) * Math.sin(inclinationRad);
            points.push(new THREE.Vector3(x, y, z));
          }

          const geometry = new THREE.BufferGeometry().setFromPoints(points);
          const material = new THREE.LineBasicMaterial({
            color: 0x88cc88,
            transparent: true,
            opacity: 0.2,
            linewidth: 0.5,
          });

          const orbitLine = new THREE.Line(geometry, material);
          orbitLine.visible = this.showMoonOrbits;

          // Store by planet and moon name
          if (!this.moonOrbitLines[planetName])
            this.moonOrbitLines[planetName] = {};
          this.moonOrbitLines[planetName][moonData.name] = orbitLine;

          // Add to planet so it moves with the planet
          planet.add(orbitLine);
        }

        createLabel(name, mesh) {
          const labelDiv = document.createElement("div");
          labelDiv.className = "planet-label";
          labelDiv.textContent = name;
          labelDiv.style.display = this.showLabels ? "block" : "none";
          document.body.appendChild(labelDiv);
          this.labels[name] = labelDiv;
        }

        setupControls() {
          // OrbitControls setup
          this.controls = new THREE.OrbitControls(
            this.camera,
            this.renderer.domElement
          );
          this.controls.enableDamping = true;
          this.controls.dampingFactor = 0.05;
          this.controls.screenSpacePanning = false;
          this.controls.minDistance = 5;
          this.controls.maxDistance = 10000;
          this.controls.target.set(0, 0, 0);
          this.controls.update();

          // Time scale control
          const timeScaleSlider = document.getElementById("timeScale");
          const timeScaleVal = document.getElementById("timeScaleVal");

          timeScaleSlider.addEventListener("input", (e) => {
            this.timeScale = parseFloat(e.target.value);
            timeScaleVal.textContent = `${this.timeScale}x`;
          });

          // Visibility toggles
          document
            .getElementById("showOrbits")
            .addEventListener("change", (e) => {
              this.showOrbits = e.target.checked;
              this.toggleOrbits();
            });

          document
            .getElementById("showMoonOrbits")
            .addEventListener("change", (e) => {
              this.showMoonOrbits = e.target.checked;
              this.toggleMoonOrbits();
            });

          document
            .getElementById("showLabels")
            .addEventListener("change", (e) => {
              this.showLabels = e.target.checked;
              this.toggleLabels();
            });

          document
            .getElementById("showMoons")
            .addEventListener("change", (e) => {
              this.showMoons = e.target.checked;
              this.toggleMoons();
            });

          // Control buttons
          document.getElementById("pauseBtn").addEventListener("click", () => {
            this.paused = !this.paused;
            document.getElementById("pauseBtn").textContent = this.paused
              ? "Resume"
              : "Pause";
          });

          document
            .getElementById("autoRotateBtn")
            .addEventListener("click", () => {
              this.autoRotate = !this.autoRotate;
              this.controls.autoRotate = this.autoRotate;
              document.getElementById("autoRotateBtn").textContent = this
                .autoRotate
                ? "Auto-Rotate: ON"
                : "Auto-Rotate: OFF";
            });

          document.getElementById("resetBtn").addEventListener("click", () => {
            this.resetView();
          });

          // Planet focus buttons
          document.querySelectorAll(".planet-btn").forEach((btn) => {
            btn.addEventListener("click", () => {
              document
                .querySelectorAll(".planet-btn")
                .forEach((b) => b.classList.remove("active"));
              btn.classList.add("active");

              const planetName = btn.getAttribute("data-planet");
              this.focusOnPlanet(this.planets[planetName]);
            });
          });

          // Double-click to focus on planets
          this.renderer.domElement.addEventListener("dblclick", (e) => {
            const rect = this.renderer.domElement.getBoundingClientRect();
            this.mouse.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
            this.mouse.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;

            this.raycaster.setFromCamera(this.mouse, this.camera);
            const intersects = this.raycaster.intersectObjects(
              Object.values(this.planets)
            );

            if (intersects.length > 0) {
              const planet = intersects[0].object;
              this.focusOnPlanet(planet);
            }
          });

          // Mouse move for tooltips
          this.renderer.domElement.addEventListener("mousemove", (e) => {
            const rect = this.renderer.domElement.getBoundingClientRect();
            this.mouse.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
            this.mouse.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;

            this.raycaster.setFromCamera(this.mouse, this.camera);
            const intersects = this.raycaster.intersectObjects(
              Object.values(this.planets)
            );

            if (intersects.length > 0) {
              const planet = intersects[0].object;
              if (this.hoveredPlanet !== planet) {
                this.hoveredPlanet = planet;
                this.showTooltip(planet.userData, e.clientX, e.clientY);
              }
            } else {
              this.hideTooltip();
            }
          });
        }

        showTooltip(planetData, x, y) {
          let moonsList = "";
          if (planetData.data.moons) {
            moonsList = `<p><strong>Moons:</strong> ${planetData.data.moons
              .map((m) => m.name)
              .join(", ")}</p>`;
          }

          this.tooltip.innerHTML = `
                <h3>${planetData.name}</h3>
                <p>${planetData.description}</p>
                <p><strong>Type:</strong> ${planetData.data.type}</p>
                <p><strong>Radius:</strong> ${planetData.data.radius.toLocaleString()} km</p>
                <p><strong>Orbital Inclination:</strong> ${(
                  planetData.data.orbitalInclination || 0
                ).toFixed(1)}°</p>
                <p><strong>Distance from Sun:</strong> ${
                  planetData.data.distance
                    ? (planetData.data.distance * 1.5).toLocaleString() +
                      " million km"
                    : "N/A"
                }</p>
                ${moonsList}
            `;
          this.tooltip.style.left = x + 10 + "px";
          this.tooltip.style.top = y + 10 + "px";
          this.tooltip.classList.add("show");
        }

        hideTooltip() {
          this.tooltip.classList.remove("show");
          this.hoveredPlanet = null;
        }

        focusOnPlanet(planet) {
          if (!planet) return;

          // Update active button
          document.querySelectorAll(".planet-btn").forEach((btn) => {
            btn.classList.remove("active");
            if (btn.getAttribute("data-planet") === planet.userData.name) {
              btn.classList.add("active");
            }
          });

          // Set camera to look at the planet
          this.controls.target.copy(planet.position);

          // Adjust camera distance to be proportional to planet size
          const desiredDistance = planet.userData.originalRadius * 15;
          const currentDistance = this.camera.position.distanceTo(
            planet.position
          );

          // Move camera closer if too far, further if too close
          const direction = new THREE.Vector3()
            .subVectors(this.camera.position, planet.position)
            .normalize();

          const newPosition = planet.position
            .clone()
            .add(direction.multiplyScalar(desiredDistance));

          this.camera.position.copy(newPosition);
          this.controls.update();
        }

        toggleOrbits() {
          Object.values(this.orbitLines).forEach((orbitLine) => {
            orbitLine.visible = this.showOrbits;
          });
        }

        toggleMoonOrbits() {
          Object.entries(this.moonOrbitLines).forEach(
            ([planetName, moonOrbits]) => {
              Object.values(moonOrbits).forEach((orbitLine) => {
                orbitLine.visible = this.showMoonOrbits;
              });
            }
          );
        }

        toggleLabels() {
          Object.values(this.labels).forEach((label) => {
            label.style.display = this.showLabels ? "block" : "none";
          });

          // Update moon labels visibility
          for (const planetName in this.moonLabels) {
            for (const moonName in this.moonLabels[planetName]) {
              const label = this.moonLabels[planetName][moonName];
              label.style.display = this.showLabels ? "block" : "none";
            }
          }
        }

        toggleMoons() {
          Object.entries(this.moons).forEach(([planetName, moons]) => {
            Object.values(moons).forEach((moon) => {
              moon.visible = this.showMoons;
            });
          });
        }

        resetView() {
          this.controls.reset();
          this.camera.position.set(0, 300, 500);
          this.controls.target.set(0, 0, 0);
          this.controls.update();
          this.elapsedTime = 0;

          // Reset active button to Sun
          document.querySelectorAll(".planet-btn").forEach((btn) => {
            btn.classList.remove("active");
            if (btn.getAttribute("data-planet") === "Sun") {
              btn.classList.add("active");
            }
          });
        }

        updateLabels() {
          // Update planet labels
          Object.entries(this.labels).forEach(([name, label]) => {
            const planet = this.planets[name];
            if (planet && this.showLabels) {
              const vector = planet.position.clone();
              vector.project(this.camera);

              const x = (vector.x * 0.5 + 0.5) * window.innerWidth;
              const y = (vector.y * -0.5 + 0.5) * window.innerHeight;

              label.style.left = x + "px";
              label.style.top = y - 30 + "px";
              label.style.display =
                vector.z < 1 && this.showLabels ? "block" : "none";
            }
          });

          // Update moon labels
          for (const planetName in this.moonLabels) {
            for (const moonName in this.moonLabels[planetName]) {
              const moon = this.moons[planetName][moonName];
              const label = this.moonLabels[planetName][moonName];

              if (moon && label) {
                // Get moon's world position
                const worldPosition = new THREE.Vector3();
                moon.getWorldPosition(worldPosition);
                worldPosition.project(this.camera);

                const x = (worldPosition.x * 0.5 + 0.5) * window.innerWidth;
                const y = (worldPosition.y * -0.5 + 0.5) * window.innerHeight;

                label.style.left = x + "px";
                label.style.top = y - 15 + "px";
                label.style.display =
                  worldPosition.z < 1 && this.showLabels ? "block" : "none";
              }
            }
          }
        }

        updateFPS() {
          const now = performance.now();
          const delta = now - this.lastTime;
          this.lastTime = now;

          if (delta > 0) {
            this.fps = Math.round(1000 / delta);
            this.fpsCounter++;
            this.fpsTime += delta;

            if (this.fpsTime >= 1000) {
              document.getElementById("fps").textContent = this.fps;
              this.fpsTime = 0;
              this.fpsCounter = 0;
            }
          }
        }

        updateOrbitalPositions() {
          if (this.paused) return;

          const deltaTime = this.clock.getDelta();
          this.elapsedTime += (deltaTime * this.timeScale) / 10;

          // Update current time display
          document.getElementById("currentTime").textContent =
            this.elapsedTime.toFixed(2);

          // Update planet positions
          Object.entries(this.planets).forEach(([name, mesh]) => {
            const data = PLANETS[name];
            if (data.type === "star") return;

            // Calculate orbital position with inclination
            const angle =
              (this.elapsedTime * (Math.PI * 2)) / data.orbitalPeriod;
            const distance = mesh.userData.orbitalRadius;
            const inclination = data.orbitalInclination || 0;
            const inclinationRad = THREE.MathUtils.degToRad(inclination);

            const x = distance * Math.cos(angle);
            const z = distance * Math.sin(angle) * Math.cos(inclinationRad);
            const y = distance * Math.sin(angle) * Math.sin(inclinationRad);

            mesh.position.set(x, y, z);

            // Planet rotation
            if (data.rotationPeriod) {
              const rotationSpeed =
                (2 * Math.PI) / (Math.abs(data.rotationPeriod) * 24);
              mesh.rotation.y +=
                rotationSpeed *
                deltaTime *
                this.timeScale *
                (data.rotationPeriod < 0 ? -1 : 1);
            }

            // Update moon positions
            if (this.moons[name]) {
              Object.entries(this.moons[name]).forEach(([moonName, moon]) => {
                const moonData = moon.userData.data;
                const planet = mesh;

                // Moon orbital position relative to planet
                if (moonData.orbitalPeriod) {
                  const moonAngle =
                    (this.elapsedTime * (Math.PI * 2)) / moonData.orbitalPeriod;
                  const moonDistance = moon.userData.orbitalRadius;
                  const moonInclination = moonData.orbitalInclination || 0;
                  const moonInclinationRad =
                    THREE.MathUtils.degToRad(moonInclination);

                  // Calculate moon position relative to planet
                  const moonX = moonDistance * Math.cos(moonAngle);
                  const moonZ =
                    moonDistance *
                    Math.sin(moonAngle) *
                    Math.cos(moonInclinationRad);
                  const moonY =
                    moonDistance *
                    Math.sin(moonAngle) *
                    Math.sin(moonInclinationRad);

                  moon.position.set(moonX, moonY, moonZ);
                }

                // Moon rotation
                if (moonData.rotationPeriod) {
                  const moonRotationSpeed =
                    (2 * Math.PI) / (Math.abs(moonData.rotationPeriod) * 24);
                  moon.rotation.y +=
                    moonRotationSpeed *
                    deltaTime *
                    this.timeScale *
                    (moonData.rotationPeriod < 0 ? -1 : 1);
                }
              });
            }
          });
        }

        animate() {
          requestAnimationFrame(() => this.animate());
          this.updateFPS();
          this.updateOrbitalPositions();
          this.updateLabels();
          this.controls.update();
          this.renderer.render(this.scene, this.camera);
        }

        onWindowResize() {
          this.camera.aspect = window.innerWidth / window.innerHeight;
          this.camera.updateProjectionMatrix();
          this.renderer.setSize(window.innerWidth, window.innerHeight);
        }
      }

      // Initialize when page loads
      window.addEventListener("load", () => {
        new SolarSystem();
      });
    </script>
  </body>
</html>
